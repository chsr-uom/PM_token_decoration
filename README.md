### Toward value-based care using cost mining: cost aggregation and visualization across the entire colorectal cancer patient pathway.

This repository contains the python code associated with the paper. 

------------------------------------------------------------------------

#### 📖 Abstract

**Background**: The aim of this study is to develop a method we call ‘cost mining’, which involves modelling integrated patient pathways from primary care to survivorship or death, to explore cost variation and identify granular cost drivers in a systematic way. This addresses current urgent calls to address financial strains on healthcare systems, particularly for colorectal cancer, which is the most expensive cancer in Australia.

**Methods**: We developed and published a customized algorithm that dynamically estimates and visualizes the mean, minimum, and total costs of care at the patient level, by aggregating activity-based healthcare system costs (e.g. DRGs) whilst conducting process mining. This extends traditional process mining approaches by making the resulting process maps informative, by displaying cost estimates that refresh as users explore patient pathways. We demonstrate the method by constructing a unique dataset of colorectal cancer pathways in Victoria, Australia, using records of primary care, diagnosis, hospital admission and chemotherapy, medication, health system costs, and life events to create integrated colorectal cancer patient pathways from 2012 to 2020.

**Results**: The aggregated cost estimates generated by the algorithm enabled case-mix group comparisons and the exploration of costly integrated pathways, i.e. drilling down in high-cost pathways to discover cost drivers, for 4246 cases. Per-patient CRC pathway costs ranged from $10,379 AUD to $41,643 AUD, and vary significantly per cancer stage such that e.g. chemotherapy costs in one cancer stage are different the same chemotherapy regimen in a different stage. Admitted episodes were most costly, representing 93.34% or $56.6M AUD of the total healthcare system costs covered in the sample, next to chemotherapy episodes. 

**Conclusion**: Cost mining can supplement other health economic methods by providing contextual, sequence and timing-related information into how patients flow through complex care pathways. Systematic cost mining can inform decision-makers on where to target mixed-methods improvement initiatives, and it can be used to evaluate the consequences of care delivery changes on integrated pathways from primary care to outcomes like death or survivorship. 
We provide suggestions for hospitals and policymakers looking to improve their health data infrastructure to enable real time patient level cost mining.   

------------------------------------------------------------------------

#### 🔍 Repository content

``` bash
├── token_decoration_custom.py    # this is the pm4py code for the token decoration of costs  
├── using_token_decoration.R      # this is R code that details how to use decoration function in R
├── commented_token_custom.py     # this is a commented version of the token decoration code
└── README.md
```
------------------------------------------------------------------------

#### 🔧 What is the required set-up?

The custom code contains two primary functions, get_decorations() and apply(), which are extensions of the PM4Py library for process mining. These functions are used to calculate decorations and apply them to a Petri net for visualization, with a focus on the performance measure obtained by token replay.

The functions are part of a custom algorithm which has been embedded in the PM4Py package due to the Object-Oriented Programming (OOP) nature of the codebase. The custom variant needs to be located at pm4py --> visualization --> petrinet --> variants --> token_decoration_custom in the package directory structure.

The OOP style coding of PM4Py allows parameters to be provided at a higher level and then passed down to the individual level where these functions operate. Thus, parameters such as the measure, activity key, and timestamp key are initially specified at a more general level in the codebase and are then utilized within these functions.

For executing this code, it's important to have the PM4Py package installed and understand the structure of the package. You should also have an appropriate process log and its corresponding Petri net, along with its initial and final markings. Finally, to correctly use these functions, understanding the role and effect of parameters, as well as the fundamentals of process mining and Petri nets, is required.
The codebase with this custom variant has been made available in the specified repository, providing direct access to the modifications and additions made for this specific use case.

------------------------------------------------------------------------

#### 💪 What are the functions?

The first function, get_decorations, is used to calculate metrics, referred to as decorations, for a given Petri net. These decorations, which include measures such as frequency and performance, serve to annotate the Petri net. The function takes as input the trace log of the process, the Petri net, initial and final markings, and other optional parameters. It then applies a sequence of operations: extracting variants from the log trace, applying token replay to align the log and model, computing single-element statistics, and finally aggregating these statistics.

The second function, apply, leverages the computed decorations to visualize the Petri net. If no aggregated statistics are provided, it invokes the get_decorations function to compute them. It then passes the net, markings, and decorations to a function in PM4Py, visualize.apply, to generate and return the final visualization of the Petri net.

Thus, the overall function of this script is to enrich and visualize Petri nets with performance information derived from process logs, facilitating better understanding and analysis of the process. We leverage this to provide costing decoration in process mining applies to the healthcare setting.


*Please get in touch with any questions or suggestions!*
